
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mounting an S3 Bucket Using FUSE - Steve Robinson</title>
  <meta name="author" content="Steve Robinson">

  
  <meta name="description" content="Have you ever wanted to interact with your Amazon S3 bucket just like how you deal with the directories in the file system without having to mess &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://steverobinson.in/blog/2015/03/29/mounting-an-s3-bucket">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Steve Robinson" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-61293469-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Steve Robinson</a></h1>
  
    <h2>My life, code & random musings...</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:steverobinson.in" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Mounting an S3 Bucket Using FUSE</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-29T16:52:23+05:30" pubdate data-updated="true">Mar 29<sup>th</sup>, 2015</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Have you ever wanted to interact with your Amazon S3 bucket just like how you deal with the directories in the file system without having to mess around with an API? I recently came across a really cool tool that allows you to do just that. The technology that this tool uses, like some of you might have guessed, is FUSE (Filesystems in User Space).</p>

<!--more-->


<p>So what is FUSE? I&rsquo;ve heard about it before and I had even used it blindly in college in our FOSS lab but never had a concrete understanding. While I was trying to learn about it, I came across <a href="http://www.cs.nmsu.edu/~pfeiffer/fuse-tutorial/">this page</a> which puts FUSE in plain terms and I am quoting from it -</p>

<blockquote><p>One of the real contributions of Unix has been the view that &ldquo;everything is a file&rdquo;. A tremendous number of radically different sorts of objects, from data storage to file format conversions to internal operating system data structures, have been mapped to the file abstraction. One of the more recent directions this view has taken has been Filesystems in User Space, or FUSE (no, the acronym really doesn&rsquo;t work. Oh well). The idea here is that if you can envision your interaction with an object in terms of a directory structure and filesystem operations, you can write a FUSE file system to provide that interaction. You just write code that implements file operations like open(), read(), and write(); when your filesystem is mounted, programs are able to access the data using the standard file operation system calls, which call your code.</p></blockquote>

<p>This simply blew my mind! After learning about FUSE I could imagine how easily something like S3 or heck even a database like MySQL can be treated as a file system using FUSE.</p>

<p>Okay now the software I found is called <a href="https://github.com/s3fs-fuse/s3fs-fuse">s3fs-fuse</a>. It&rsquo;s written in C++ and although I&rsquo;m not a big fan of the language reading through the codebase gave a really good insight on writing a FUSE filesystem.</p>

<p>So here&rsquo;s how you use use s3fs-fuse. Download the project from the <a href="https://github.com/s3fs-fuse/s3fs-fuse">github repo</a> and install it by following the instructions on the <a href="https://github.com/s3fs-fuse/s3fs-fuse/wiki/Installation-Notes">wiki</a>. Now I could not find a binary release so you&rsquo;ll have to build the project on your own. Its not as hard as it sounds.</p>

<p>Once you have it installed, you need to store your AWS credentials in a file at either <code>~/.passwd-s3fs</code> (600 permission) or <code>/etc/passwd-s3fs</code> (640 permission) in the format - <code>accessKeyId:secretAccessKey</code>.</p>

<p>Now we&rsquo;re all set. Let&rsquo;s say we need to mount our S3 bucket - <code>fuse-ftw</code>. To do that we need to run the following command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/usr/bin/s3fs fuse-ftw /mnt</span></code></pre></td></tr></table></div></figure>


<p>and that is it! s3fs also allows provides few options to control the way the bucket is mounted. Some of the useful ones are:</p>

<ul>
<li><p><strong>default_acl</strong> - lets you set the default <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html">canned access control policy</a> for the objects stored in the bucket. The default value for this is <code>private</code>. You can set it to, say, <code>public-read</code> to allow everyone to read but restrict all other operations.</p></li>
<li><p><strong>use_cache</strong> - this is a cool option that lets you tell s3fs to use a local folder to cache the objects (files) so that it can avoid unnecessarily downloading files from S3. It uses MD5 checksums to make sure cache is valid.</p></li>
<li><p><strong>retries</strong> - this sets the number of times that you would like s3fs to retry an operation upon failure.</p></li>
</ul>


<p>Check the wiki for more options and a much more detailed write up on the way this works and its limitations.</p>

<p>And FUSE is totally cool. I mentioned about treating a database as a filesystem earlier right? Well, I found a python library called <a href="https://github.com/clsn/mysqlfuse">mysqlfuse</a> that does just that! Check it out.</p>

<p>Have you used FUSE for doing something interesting? Let me know by dropping a comment below.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Steve Robinson</span></span>

      








  


<time datetime="2015-03-29T16:52:23+05:30" pubdate data-updated="true">Mar 29<sup>th</sup>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/sysadmin/'>sysadmin</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://steverobinson.in/blog/2015/03/29/mounting-an-s3-bucket/" data-via="stev4nity" data-counturl="http://steverobinson.in/blog/2015/03/29/mounting-an-s3-bucket/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/03/11/lack-of-diskspace-makes-passenger-throw-rackrewindableinput-not-found/" title="Previous Post: RackRewindableInput lock file not found">&laquo; RackRewindableInput lock file not found</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/29/mounting-an-s3-bucket/">Mounting an S3 Bucket Using FUSE</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/11/lack-of-diskspace-makes-passenger-throw-rackrewindableinput-not-found/">RackRewindableInput Lock File Not Found</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/21/ruby-2-dot-0-boosts-rails-boot-time/">Ruby 2.0 Boosts Rails Boot Time</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/30/your-own-geocoding-service/">Hosting FreeGeoIP in Your Cloud</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/31/outsourcing-image-processing/">Outsourcing Image Processing</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Steve Robinson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'steverobinson';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://steverobinson.in/blog/2015/03/29/mounting-an-s3-bucket/';
        var disqus_url = 'http://steverobinson.in/blog/2015/03/29/mounting-an-s3-bucket/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
